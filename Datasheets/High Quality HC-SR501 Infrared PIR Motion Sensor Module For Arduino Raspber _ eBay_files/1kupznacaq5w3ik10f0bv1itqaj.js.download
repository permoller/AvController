(function(b){var i=function(b){this.init(b)};b.extend(i.prototype,{init:function(b){this.cfg=b;this.answerState=null;this.getInitialTemplates(b);this.registerAskQuestionEvents(b);this.registerAddAnswerEvents(b);this.registerReportAnswerEvents(b)},getInitialTemplates:function(b){var a=this.getParams(b);this.callAjax("get-templates",{},a,null,"GET",b,this.getInitialTemplatesSuccess,this.getInitialTemplatesFailure)},getParams:function(b){return b.productId+"?isWidget=true&listing_id="+b.itemId},getInitialTemplatesSuccess:function(d){var a=
document.createElement("html"),c=b(".qna-wrapper-ask-question .ask-question-card");a.innerHTML=d.body.content;d=a.getElementsByClassName("ask-question-card");b(".qna-wrapper-ask-question .spinner").remove();c&&c.remove();d&&d[0]?b(".qna-wrapper-ask-question").append(d[0]):this.getInitialTemplatesFailure();b(".write-answer-form").append(a.getElementsByClassName("write-answer-card")[0])},getInitialTemplatesFailure:function(){b(".qna-wrapper-ask-question").remove()},registerAskQuestionEvents:function(d){var a=
this;b(".qna--wrapper").on("keyup",".ask-question-card .textbox__control",function(c){a.handleQnATextAreaKeyUp(c,b(this)[0],500,"QUESTION")});b(".qna--wrapper").on("focus",".ask-question-card .textbox__control",function(c){a.handleQnATextAreaFoucs(c,b(this)[0],500)});b(".qna--wrapper").on("blur",".ask-question-card .textbox__control",function(c){a.handleQnATextAreaBlur(c,b(this)[0])});b(".qna--wrapper").on("click",".ask-question-card #submit-question",function(){var c=b(this).data("params"),e=c.productId+
"?isWidget=true",g={questionText:b(".ask-question-card .textbox__control").val()},f;for(f in c)g[f]=c[f];a.callAjax("create-question",g,e,b(this),"POST",d,a.askQuestionSuccess,a.askQuestionFailure)});b(".qna--wrapper").on("click",".ask-new-question button",function(){b(".qna-wrapper-ask-question .write-question-success").hide();b(".qna-wrapper-ask-question .ask-question-card .textbox__control").removeClass("question-error");b(".qna-wrapper-ask-question .ask-question-card").find(".inline-alert").remove();
b(".qna-wrapper-ask-question .ask-question-card .textbox__control").val("");b(".qna-wrapper-ask-question .ask-question-card").show()})},askQuestionSuccess:function(d){var a=document.createElement("html");a.innerHTML=d.body.content;var d=a.getElementsByClassName("write-question-success")[0],a=a.getElementsByClassName("inline-alert")[0],c=b(".qna-wrapper .write-question-success"),e=b(".qna-wrapper-ask-question .ask-question-card");e.find(".inline-alert")&&e.find(".inline-alert").remove();var g=e.find(".textbox textarea");
a?(g.addClass("question-error"),g.after(a)):(g.removeClass("question-error"),c.length&&b(".write-question-success").remove(),e.hide(),b(".qna-wrapper-ask-question").append(d))},askQuestionFailure:function(){},registerAddAnswerEvents:function(d){var a=this;b(".qna--wrapper").on("keyup",".write-answer-card .textbox__control",function(c){a.handleQnATextAreaKeyUp(c,b(this)[0],5E3,"ANSWER")});b(".qna--wrapper").on("focus",".write-answer-card .textbox__control",function(c){a.handleQnATextAreaFoucs(c,b(this)[0],
5E3)});b(".qna--wrapper").on("blur",".write-answer-card .textbox__control",function(c){a.handleQnATextAreaBlur(c,b(this)[0])});b(".qna--wrapper").on("click",'button[name="qnaAddAnswerBtn"]',function(){var a=b(this).closest(".question-card").find(".write-answer-form");a&&(b(this).hide(),a.show(),setTimeout(function(){a.find("textarea").focus()},0))});b(".qna--wrapper").on("click",".cancel-btn",function(){var a=b(this).closest(".question-card");"SUCCESS_ANSWER"===a.data("state")?(a.find(".write-answer-form").hide(),
a.find(".write-answer-success").show()):(a.find(".write-answer-form").hide(),a.find('button[name="qnaAddAnswerBtn"]').show())});b(".qna--wrapper").on("click",'button[name="submitAnswer"]',function(){var c=b(this).closest(".question-card"),e=c.attr("id").split("-")[1],g="create-answer",f=b(this).data("params"),k=e+"?isWidget=true",h=c.data("state"),e={answerText:c.find(".write-answer-card .textbox textarea").val(),questionId:e},j;for(j in f)e[j]=f[j];"SUCCESS_ANSWER"===h&&(k=c.find('input[name="answerId"]').val()+
"?isWidget=true",g="update-answer");a.callAjax(g,e,k,c,"POST",d,a.addAnswerSuccess,a.addAnswerFailure)});b(".qna--wrapper").on("click",".edit-answer-button",function(){var a=b(this).closest(".question-card");a.data("state","SUCCESS_ANSWER");a.find(".write-answer-form").show();a.find(".write-answer-success").hide()});b(".qna--wrapper").on("click",".delete-answer-button",function(){var a=b(this).closest(".question-card");a.data("state","SUCCESS_ANSWER");a.find(".write-answer-success").hide();a.find(".delete-answer-confirmation").show()});
b(".qna--wrapper").on("click",".submit-delete-answer",function(){var c=b(this).closest(".question-card"),e=c.find('input[name="answerId"]').val();a.callAjax("delete-answer",{},e+"?isWidget=true",c,"POST",d,a.deleteAnswerSuccess,a.deleteAnswerFailure)});b(".qna--wrapper").on("click",".cancel-delete-answer",function(){var a=b(this).closest(".question-card");a.find(".write-answer-success").show();a.find(".delete-answer-confirmation").hide()})},addAnswerSuccess:function(d,a){var c=document.createElement("html");
c.innerHTML=d.body.content;var e=c.getElementsByClassName("write-answer-success"),g=c.getElementsByClassName("write-answer-card"),f=a.find(".write-answer-form").find(".textbox textarea");a.find(".inline-alert")&&a.find(".inline-alert").remove();g.length?(f.addClass("answer-error"),f.after(b(g).find(".inline-alert"))):e.length&&(a.find(".write-answer-form").hide(),f.removeClass("answer-error"),a.find(".write-answer-success")&&a.find(".write-answer-success").remove(),a.find(".delete-answer-confirmation")&&
a.find(".delete-answer-confirmation").remove(),a.append(c.getElementsByClassName("write-answer-success")[0]),a.append(c.getElementsByClassName("delete-answer-confirmation")[0]),a.data("state","SUCCESS_ANSWER"))},addAnswerFailure:function(){},deleteAnswerSuccess:function(b,a){a.find(".write-answer-form").hide();a.find(".delete-answer-confirmation").hide();a.find(".inline-alert")&&a.find(".inline-alert").remove();a.find(".textbox textarea")&&a.find(".textbox textarea").removeClass("answer-error");a.find('button[name="qnaAddAnswerBtn"]').show();
a.data("state","INITIAL")},deleteAnswerFailure:function(){},registerReportAnswerEvents:function(d){var a=this;b(".qna--wrapper").on("click",".answer-card .reportBtn",function(){a.isUserLoggedIn(d)?(b(this).closest(".engage-signal-wrapper").append(b(".report-spam-overlay")),b(".report-spam-overlay").show()):window.location=d.signInUrl});b(document).keyup(function(a){27===a.keyCode&&b(".report-spam-overlay").is(":visible")&&b(".report-spam-overlay").hide()});b(".report-spam-overlay").on("click",".radios div",
function(){b(this).find("input[type=radio]").prop("checked",!0);b(this).closest(".radios").find(".btn").prop("disabled",!1)});b(".report-spam-overlay").on("click",".overlay-close",function(){a.handleCancelReportSpam()});b(".report-spam-overlay").on("click",".radios .cancel-report-answer",function(){a.handleCancelReportSpam()});b(".report-spam-overlay").on("click",".radios .submit-report-answer",function(){a.handleSubmitReportSpam(b(this),d)})},handleCancelReportSpam:function(){b(".report-spam-overlay").hide();
b(".report-spam .btn").prop("disabled",!0);b(".report-spam .radios").find("input").attr("checked",!1)},handleSubmitReportSpam:function(b,a){var c=b.closest(".answer-card"),e=c.attr("id").split("-")[1],g=c.find(".engage-signal-wrapper .radios").find("input:checked");this.callAjax("report-answer",{spamCode:g.val(),reportAction:"inappropriate"},e+"?isWidget=true",c,"POST",a,this.reportSpamSuccess,this.reportSpamFailure)},reportSpamSuccess:function(d){var a=document.createElement("html");a.innerHTML=
d.body.content;b(".report-spam-overlay .report-spam").hide();b(".report-spam-overlay").append(a.getElementsByClassName("report-success-conainer")[0]);setTimeout(function(){b(".report-spam-overlay").hide();b(".report-spam-overlay .report-spam").show();b(".report-spam-overlay .report-success-conainer").remove()},1E3)},reportSpamFailure:function(){},handleQnATextAreaFoucs:function(d,a,c){this.showCtr(b(a).siblings(".contentCounter"));this.handleContentCounter(a,c)},handleQnATextAreaBlur:function(d,a){this.hideCtr(b(a).siblings(".contentCounter"))},
handleQnATextAreaKeyUp:function(b,a,c,e){if(this.isAlphanumericKey(b.which||b.keyCode||b.charCode)&&"QUESTION"===e&&"?"!==a.value[a.value.length-1]&&0>a.value.indexOf("?"))a.value+="?",this.setCaretPosition(a,a.value.length-1);this.handleContentCounter(a,c)},showCtr:function(b){b.css("visibility","visible")},hideCtr:function(b){b.css("visibility","hidden")},setCaretPosition:function(b,a){b.setSelectionRange&&(b.focus(),b.setSelectionRange(a,a))},isAlphanumericKey:function(b){return/[a-zA-Z0-9-_ ]/.test(String.fromCharCode(b))?
!0:!1},handleContentCounter:function(d,a){var c=d.value,c=0>a-c.length?0:a-c.length,e=b(d).parent().find(".contentCounter");e.text(c);e.css("color",0>=c?"#dd1e33":"#4a4a4a")},isUserLoggedIn:function(b){var a=raptor.require("ebay.cookies"),c=raptor.require("Base64"),e=!1;null!==a&&(void 0!==a&&null!=b)&&(a=a.readCookie("dp1","u1p"),c=c.decode(decodeURIComponent(a)),a=b.username,e=b.isUserSignedIn&&""!=c&&c===a);return e},callAjax:function(d,a,c,e,g,f,h,i){c=f.baseDomain+"/qna/proxy/"+d+"/"+c;"get-templates"===
d||this.isUserLoggedIn(f)?(f.ajaxCSRFToken&&(a.srt=f.ajaxCSRFToken),""!==c&&(d={url:c,type:g,data:a,timeout:5E3,dataType:"json"},"production"!==f.env&&(d.xhrFields={withCredentials:!0},d.crossDomain=!0),b.ajax(d).done(function(a){h(a,e)}).fail(function(a){i(a,e)}))):window.location=f.signInUrl}});var h=null;b.QnAWidgetInit=function(b){h||(h=new i(b));return h}})(window.jQuery);